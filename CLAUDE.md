# tmux-resurrect-slots

Slot-based save/restore UI for tmux-resurrect using fzf-tmux popup.
Like game save slots — keep multiple tmux session snapshots and pick which to restore.

## File Structure

```
.
├── resurrect_slots.tmux      # Entry point: read options, bind keys
├── scripts/
│   ├── lib.sh                # Shared utils (fzf wrapper, lock, paths, display)
│   ├── meta.sh               # meta.tsv management (slot metadata CRUD)
│   ├── save.sh               # Save workflow
│   ├── restore.sh            # Restore workflow
│   └── rename.sh             # Rename slot label
├── README.md
├── LICENSE                   # MIT
└── .editorconfig
```

## Data Layout

```
~/.tmux/resurrect/slots/
  meta.tsv          # slot_id \t epoch \t iso \t label \t session_summary
  slot1.txt         # copied resurrect file
  slot2.txt
  ...
```

## Key Bindings (default)

| Key | Action | Script |
|-----|--------|--------|
| `Prefix + Ctrl-s` | Save | `scripts/save.sh` |
| `Prefix + Ctrl-r` | Restore | `scripts/restore.sh` |
| `Prefix + Ctrl-e` | Rename | `scripts/rename.sh` |

## tmux Options

| Option | Default | Description |
|--------|---------|-------------|
| `@resurrect_slots` | `5` | Number of save slots |
| `@resurrect_slots_override_default_keys` | `on` | Override resurrect default keybindings |
| `@resurrect_slots_enable_rename` | `on` | Enable rename keybinding |

## Dependencies

- **Required**: tmux-resurrect
- **Optional**: fzf (for popup UI; without it, auto-selects latest slot)

## Coding Conventions

### Shell

- Shebang: `#!/usr/bin/env bash`
- Minimize bashisms; stay POSIX-friendly where practical
- No GNU-only flags — must work on macOS default tools
- `date +"%Y-%m-%d %H:%M:%S"` for display timestamps
- `date +"%Y-%m-%dT%H:%M:%S%z"` for ISO timestamps

### Naming

- Constants: `UPPER_SNAKE_CASE`
- Local variables: `lower_snake_case`
- Functions: `lower_snake_case`
- tmux options prefix: `@resurrect_slots`

### Style

- Quote all variable expansions: `"${var}"`
- Use `local` for function-scoped variables
- Error messages to stderr: `echo "error" >&2`
- Exit codes: 0 success, 1 general error

## Testing

No automated test framework. Validate by:

1. `shellcheck scripts/*.sh resurrect_slots.tmux` — static analysis
2. Manual test in tmux session after `tmux source ~/.tmux.conf`
3. Test both with and without fzf installed
4. Test on macOS (default BSD tools) and Linux

## Architecture Notes

- All slot operations protected by file lock (flock or mkdir fallback)
- `meta.tsv` is single source of truth for slot state
- tmux-resurrect's `last` symlink is used as the bridge between plugins
- fzf-tmux popup: `-p -w 62% -h 38%`
- Save flow: resurrect save -> find latest file -> pick slot -> cp to slot -> update meta
- Restore flow: pick slot via fzf -> symlink slot to `last` -> resurrect restore


<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

*No recent activity*
</claude-mem-context>